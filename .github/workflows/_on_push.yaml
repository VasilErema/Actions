name: Push verification

on:
  push:
    branches:
      - '*' # Trigger on any branch
  workflow_dispatch:

jobs:
  verify_installation_job:
    name: Verify if we can install Gems
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - uses: ruby/setup-ruby@v1
        with:
          bundler-cache: true

      - name: Install bundle
        run: |
          bundle config unset deployment
          bundle install

      - name: Run All tests
        run: |
          echo 'TODO: Run all tests'
          echo "SHOULD_SKIP=${{ env.SHOULD_SKIP }}"

      - name: Create or Update Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Check if a PR already exists for this branch
          EXISTING_PR=$(gh pr list --state open --head "${{ env.branch_name }}" --json url --jq '.[0].url')

          if [ -z "$EXISTING_PR" ]; then
            # No PR exists; create a new one
            PR_TITLE="[Auto PR] ${{ env.branch_name }}"
            gh pr create --base main --head "${{ env.branch_name }}" --title "$PR_TITLE --body ""
          fi
